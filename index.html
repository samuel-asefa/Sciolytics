<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sciolytics</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="main.js">
</head>
<body>
    <header>
        <div class="container header-content">
            <a href="#" class="logo">Sciolytics</a>
            <nav class="nav-links">
                <a href="#" class="active">Home</a>
                <a href="#">Tests</a>
                <a href="#">Resources</a>
                <a href="#">About</a>
            </nav>
            <div class="auth-buttons" id="authButtons">
                <button class="btn btn-outline" onclick="openModal('loginModal')">Login</button>
                <button class="btn btn-primary" onclick="openModal('registerModal')">Sign Up</button>
            </div>
            <div class="auth-buttons" id="userArea" style="display: none;">
                <span id="welcomeUser">Welcome, User!</span>
                <button class="btn btn-outline" onclick="logout()">Logout</button>
            </div>
        </div>
    </header>

    <main class="container">
        <section class="home-section">
            <div class="hero">
                <h1>Prepare for Science Olympiad</h1>
                <p>Practice with our comprehensive test platform designed specifically for Science Olympiad events. Track your progress and improve your scores.</p>
                <button class="btn btn-primary" onclick="showTestsSection()">Start Practicing</button>
            </div>

            <h2>Popular Subjects</h2>
            <div class="subjects-grid">
                <div class="card">
                    <h3>Biology</h3>
                    <p>Test your knowledge in cell biology, genetics, evolution, and ecology.</p>
                    <button class="btn btn-outline" onclick="showTestList('biology')">View Tests</button>
                </div>
                <div class="card">
                    <h3>Chemistry</h3>
                    <p>Practice with tests covering atomic structure, chemical reactions, and equilibrium.</p>
                    <button class="btn btn-outline" onclick="showTestList('chemistry')">View Tests</button>
                </div>
                <div class="card">
                    <h3>Physics</h3>
                    <p>Challenge yourself with mechanics, electricity, magnetism, and thermodynamics.</p>
                    <button class="btn btn-outline" onclick="showTestList('physics')">View Tests</button>
                </div>
                <div class="card">
                    <h3>Earth Science</h3>
                    <p>Explore geology, meteorology, oceanography, and astronomy concepts.</p>
                    <button class="btn btn-outline" onclick="showTestList('earth-science')">View Tests</button>
                </div>
            </div>
        </section>

        <section class="tests-section" style="display: none;">
            <div class="dashboard-header">
                <h2>Available Tests</h2>
                <button class="btn btn-outline" onclick="goBack()">Back</button>
            </div>
            <div id="testsList" class="subjects-grid">
            </div>
        </section>

        <section class="test-taking-section" style="display: none;">
            <div class="dashboard-header">
                <h2 id="testTitle">Test Title</h2>
                <div>
                    <span id="timer">Time: 00:00</span>
                    <button class="btn btn-outline" onclick="submitTest()">Submit Test</button>
                </div>
            </div>
            <div class="test-container" id="testContainer">
                <!-- Questions will be loaded here -->
            </div>
        </section>

        <section class="test-results-section" style="display: none;">
            <div class="dashboard-header">
                <h2>Test Results</h2>
                <button class="btn btn-outline" onclick="showTestsSection()">Back to Tests</button>
            </div>
            <div class="test-container">
                <h3 id="resultTitle">Test Name</h3>
                <div id="resultSummary">
                    <p>Score: <span id="scoreValue">0/0</span></p>
                    <p>Percentage: <span id="percentageValue">0%</span></p>
                    <p>Time taken: <span id="timeTaken">00:00</span></p>
                </div>
                <div id="resultDetails">
                    <!-- Result details will be loaded here -->
                </div>
            </div>
        </section>

        <section class="dashboard" id="dashboardSection">
            <div class="dashboard-header">
                <h2>Your Dashboard</h2>
                <button class="btn btn-outline" onclick="showTestsSection()">Take a Test</button>
            </div>
            <div class="card">
                <h3>Your Progress</h3>
                <p>Tests completed: <span id="testsCompleted">0</span></p>
                <p>Average score: <span id="averageScore">0%</span></p>
            </div>
            <div class="card">
                <h3>Recent Test Results</h3>
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Test Name</th>
                            <th>Subject</th>
                            <th>Score</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody">
                        <!-- Results will be loaded here -->
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Login</h2>
                <span class="close" onclick="closeModal('loginModal')">&times;</span>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">Login</button>
            </form>
            <p style="margin-top: 20px; text-align: center;">
                Don't have an account? <a href="#" onclick="switchModal('loginModal', 'registerModal')">Sign up</a>
            </p>
        </div>
    </div>

    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Sign Up</h2>
                <span class="close" onclick="closeModal('registerModal')">&times;</span>
            </div>
            <form id="registerForm">
                <div class="form-group">
                    <label for="registerName">Full Name</label>
                    <input type="text" id="registerName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <input type="password" id="confirmPassword" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">Sign Up</button>
            </form>
            <p style="margin-top: 20px; text-align: center;">
                Already have an account? <a href="#" onclick="switchModal('registerModal', 'loginModal')">Login</a>
            </p>
        </div>
    </div>


    <footer class="footer">
        <p>&copy; 2025 Sciolytics. All rights reserved.</p>
    </footer>

    <script>

        // ----- FRONTEND IMPLEMENTATION -----

// Dashboard HTML (to be added to your existing HTML file)
const dashboardHTML = `
<section class="dashboard" id="dashboardSection">
    <div class="dashboard-header">
        <h2>Your Dashboard</h2>
        <div class="dashboard-actions">
            <button class="btn btn-outline" onclick="filterResults('all')">All Tests</button>
            <button class="btn btn-outline" onclick="filterResults('biology')">Biology</button>
            <button class="btn btn-outline" onclick="filterResults('chemistry')">Chemistry</button>
            <button class="btn btn-outline" onclick="filterResults('physics')">Physics</button>
            <button class="btn btn-outline" onclick="filterResults('earth-science')">Earth Science</button>
            <button class="btn btn-primary" onclick="showTestsSection()">Take a New Test</button>
        </div>
    </div>

    <div class="dashboard-stats">
        <div class="stat-card">
            <div class="stat-icon">📊</div>
            <div class="stat-content">
                <span class="stat-value" id="testsCompleted">0</span>
                <span class="stat-label">Tests Completed</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">📈</div>
            <div class="stat-content">
                <span class="stat-value" id="averageScore">0%</span>
                <span class="stat-label">Average Score</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">⭐</div>
            <div class="stat-content">
                <span class="stat-value" id="highestScore">0%</span>
                <span class="stat-label">Highest Score</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">⏱️</div>
            <div class="stat-content">
                <span class="stat-value" id="averageTime">0:00</span>
                <span class="stat-label">Avg. Time per Test</span>
            </div>
        </div>
    </div>

    <div class="dashboard-charts">
        <div class="chart-container">
            <h3>Performance by Subject</h3>
            <canvas id="subjectChart"></canvas>
        </div>
        <div class="chart-container">
            <h3>Progress Over Time</h3>
            <canvas id="progressChart"></canvas>
        </div>
    </div>

    <div class="dashboard-table-container">
        <div class="table-header">
            <h3>Test History</h3>
            <div class="table-controls">
                <input type="text" id="searchInput" placeholder="Search tests..." onkeyup="searchResults()">
                <select id="sortDropdown" onchange="sortResults()">
                    <option value="date-desc">Date (Newest First)</option>
                    <option value="date-asc">Date (Oldest First)</option>
                    <option value="score-desc">Score (Highest First)</option>
                    <option value="score-asc">Score (Lowest First)</option>
                </select>
            </div>
        </div>
        <div class="results-wrapper">
            <table class="results-table">
                <thead>
                    <tr>
                        <th>Test Name</th>
                        <th>Subject</th>
                        <th>Score</th>
                        <th>Time Taken</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="resultsTableBody">
                    <!-- Results will be loaded here -->
                </tbody>
            </table>
            <div class="pagination" id="resultsPagination">
                <!-- Pagination controls will be loaded here -->
            </div>
        </div>
    </div>
</section>

<!-- Modal for detailed test result view -->
<div class="modal" id="resultDetailModal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2 id="detailTestTitle">Test Result Details</h2>
            <span class="close" onclick="closeModal('resultDetailModal')">&times;</span>
        </div>
        <div class="modal-body" id="resultDetailContent">
            <!-- Test details will be loaded here -->
        </div>
    </div>
</div>
`;

// Add this CSS to your existing stylesheet
const dashboardCSS = `
.dashboard {
    padding: 20px 0;
}

.dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 15px;
}

.dashboard-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.dashboard-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
}

.stat-icon {
    font-size: 24px;
    opacity: 0.8;
}

.stat-content {
    display: flex;
    flex-direction: column;
}

.stat-value {
    font-size: 24px;
    font-weight: bold;
    color: var(--primary);
}

.stat-label {
    color: var(--secondary);
    font-size: 14px;
}

.dashboard-charts {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.chart-container {
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    padding: 20px;
    height: 300px;
}

.chart-container h3 {
    margin-bottom: 15px;
    color: var(--dark);
}

.dashboard-table-container {
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    padding: 20px;
    margin-bottom: 30px;
}

.table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    flex-wrap: wrap;
    gap: 15px;
}

.table-controls {
    display: flex;
    gap: 10px;
}

#searchInput, #sortDropdown {
    padding: 8px 12px;
    border: 1px solid #e2e8f0;
    border-radius: 5px;
    font-size: 14px;
}

.results-table {
    width: 100%;
    border-collapse: collapse;
}

.results-table th, .results-table td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #e2e8f0;
}

.results-table th {
    background-color: #f8fafc;
    position: sticky;
    top: 0;
}

.results-wrapper {
    max-height: 500px;
    overflow-y: auto;
}

.badge {
    display: inline-block;
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
}

.badge-biology {
    background-color: #dcfce7;
    color: #16a34a;
}

.badge-chemistry {
    background-color: #dbeafe;
    color: #2563eb;
}

.badge-physics {
    background-color: #fef3c7;
    color: #d97706;
}

.badge-earth-science {
    background-color: #f3e8ff;
    color: #9333ea;
}

.pagination {
    display: flex;
    justify-content: center;
    gap: 5px;
    margin-top: 20px;
}

.page-btn {
    padding: 5px 10px;
    border: 1px solid #e2e8f0;
    background-color: white;
    border-radius: 5px;
    cursor: pointer;
}

.page-btn.active {
    background-color: var(--primary);
    color: white;
    border-color: var(--primary);
}

.modal-large {
    max-width: 800px;
    width: 90%;
}

.question-result {
    margin-bottom: 20px;
    padding: 15px;
    border-radius: 8px;
}

.question-result.correct {
    background-color: #dcfce7;
}

.question-result.incorrect {
    background-color: #fee2e2;
}

.user-stats {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    margin-bottom: 20px;
}

.stat-box {
    background-color: #f8fafc;
    padding: 15px;
    border-radius: 8px;
    flex: 1;
    min-width: 150px;
    text-align: center;
}

.stat-box h4 {
    color: var(--secondary);
    margin-bottom: 5px;
    font-size: 14px;
}

.stat-box p {
    font-size: 20px;
    font-weight: bold;
    color: var(--primary);
}

@media (max-width: 768px) {
    .dashboard-header, .table-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .table-controls {
        width: 100%;
    }
    
    .dashboard-charts {
        grid-template-columns: 1fr;
    }
    
    #searchInput, #sortDropdown {
        width: 100%;
    }
}
`;

// ----- DASHBOARD FUNCTIONALITY IMPLEMENTATION -----

// Global variables for pagination
let currentPage = 1;
const resultsPerPage = 10;
let filteredResults = [];
let currentFilter = 'all';

// Dashboard initialization
function initializeDashboard() {
    // Inject dashboard HTML if it doesn't exist
    if (!document.getElementById('dashboardSection')) {
        const mainContainer = document.querySelector('main.container');
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = dashboardHTML;
        mainContainer.appendChild(tempDiv.firstElementChild);
    }
    
    // Add CSS if not already added
    if (!document.getElementById('dashboardStyles')) {
        const styleEl = document.createElement('style');
        styleEl.id = 'dashboardStyles';
        styleEl.textContent = dashboardCSS;
        document.head.appendChild(styleEl);
    }
    
    // Load Chart.js if not already loaded
    if (typeof Chart === 'undefined') {
        const scriptEl = document.createElement('script');
        scriptEl.src = 'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js';
        scriptEl.onload = function() {
            updateDashboard();
        };
        document.head.appendChild(scriptEl);
    } else {
        updateDashboard();
    }
}

// Update dashboard with user data
function updateDashboard() {
    if (!currentUser) return;
    
    // Get all results for current user
    const userResults = testResults.filter(r => r.userId === currentUser.id);
    filteredResults = userResults;
    
    // Update stats
    document.getElementById('testsCompleted').textContent = userResults.length;
    
    // Calculate average score
    if (userResults.length > 0) {
        const totalPercentage = userResults.reduce((sum, result) => sum + result.percentage, 0);
        const averagePercentage = Math.round(totalPercentage / userResults.length);
        document.getElementById('averageScore').textContent = `${averagePercentage}%`;
        
        // Calculate highest score
        const highestPercentage = Math.max(...userResults.map(result => result.percentage));
        document.getElementById('highestScore').textContent = `${highestPercentage}%`;
        
        // Calculate average time
        const totalTime = userResults.reduce((sum, result) => sum + result.timeTaken, 0);
        const avgTime = Math.round(totalTime / userResults.length);
        const avgMinutes = Math.floor(avgTime / 60);
        const avgSeconds = avgTime % 60;
        document.getElementById('averageTime').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
    } else {
        document.getElementById('averageScore').textContent = 'N/A';
        document.getElementById('highestScore').textContent = 'N/A';
        document.getElementById('averageTime').textContent = 'N/A';
    }
    
    // Filter results based on current filter
    filterResults(currentFilter, false);
    
    // Draw charts if Chart.js is loaded
    if (typeof Chart !== 'undefined') {
        drawSubjectChart(userResults);
        drawProgressChart(userResults);
    }
}

// Draw subject performance chart
function drawSubjectChart(results) {
    const subjects = ['biology', 'chemistry', 'physics', 'earth-science'];
    const subjectNames = {
        'biology': 'Biology',
        'chemistry': 'Chemistry',
        'physics': 'Physics',
        'earth-science': 'Earth Science'
    };
    
    const subjectScores = {};
    const subjectCounts = {};
    
    // Initialize subjects
    subjects.forEach(subject => {
        subjectScores[subject] = 0;
        subjectCounts[subject] = 0;
    });
    
    // Calculate average score per subject
    results.forEach(result => {
        const subject = getSubjectFromTestId(result.testId).toLowerCase().replace(' ', '-');
        if (subjects.includes(subject)) {
            subjectScores[subject] += result.percentage;
            subjectCounts[subject]++;
        }
    });
    
    const labels = [];
    const data = [];
    const backgroundColors = [
        'rgba(34, 197, 94, 0.7)',
        'rgba(59, 130, 246, 0.7)',
        'rgba(245, 158, 11, 0.7)',
        'rgba(168, 85, 247, 0.7)'
    ];
    
    // Calculate average score for each subject
    subjects.forEach((subject, index) => {
        if (subjectCounts[subject] > 0) {
            const avgScore = Math.round(subjectScores[subject] / subjectCounts[subject]);
            labels.push(subjectNames[subject]);
            data.push(avgScore);
        }
    });
    
    // Destroy previous chart if it exists
    if (window.subjectChart instanceof Chart) {
        window.subjectChart.destroy();
    }
    
    // Create new chart
    const ctx = document.getElementById('subjectChart').getContext('2d');
    window.subjectChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Average Score (%)',
                data: data,
                backgroundColor: backgroundColors.slice(0, labels.length),
                borderColor: 'rgba(255, 255, 255, 0.5)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
}

// Draw progress over time chart
function drawProgressChart(results) {
    // Sort results by date
    const sortedResults = [...results].sort((a, b) => new Date(a.date) - new Date(b.date));
    
    const labels = [];
    const data = [];
    
    sortedResults.forEach(result => {
        const date = new Date(result.date);
        labels.push(date.toLocaleDateString());
        data.push(result.percentage);
    });
    
    // Destroy previous chart if it exists
    if (window.progressChart instanceof Chart) {
        window.progressChart.destroy();
    }
    
    // Create new chart
    const ctx = document.getElementById('progressChart').getContext('2d');
    window.progressChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Score (%)',
                data: data,
                backgroundColor: 'rgba(37, 99, 235, 0.2)',
                borderColor: 'rgba(37, 99, 235, 1)',
                borderWidth: 2,
                tension: 0.2,
                fill: true,
                pointBackgroundColor: 'rgba(37, 99, 235, 1)',
                pointRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            }
        }
    });
}

// Filter results by subject
function filterResults(filter, updateUI = true) {
    if (!currentUser) return;
    
    currentFilter = filter;
    const userResults = testResults.filter(r => r.userId === currentUser.id);
    
    if (filter === 'all') {
        filteredResults = userResults;
    } else {
        filteredResults = userResults.filter(r => {
            const subject = getSubjectFromTestId(r.testId).toLowerCase().replace(' ', '-');
            return subject === filter;
        });
    }
    
    // Reset pagination to first page
    currentPage = 1;
    
    // Update table
    updateResultsTable();
    
    // Update active filter button
    if (updateUI) {
        document.querySelectorAll('.dashboard-actions button').forEach(btn => {
            btn.classList.remove('btn-primary');
            btn.classList.add('btn-outline');
        });
        
        const activeButton = document.querySelector(`.dashboard-actions button[onclick="filterResults('${filter}')"]`);
        if (activeButton) {
            activeButton.classList.remove('btn-outline');
            activeButton.classList.add('btn-primary');
        }
    }
}

// Search results
function searchResults() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const userResults = testResults.filter(r => r.userId === currentUser.id);
    
    if (searchTerm.trim() === '') {
        filterResults(currentFilter, false);
        return;
    }
    
    filteredResults = userResults.filter(r => {
        return r.testTitle.toLowerCase().includes(searchTerm) || 
               getSubjectFromTestId(r.testId).toLowerCase().includes(searchTerm);
    });
    
    // Reset pagination to first page
    currentPage = 1;
    
    // Update table
    updateResultsTable();
}

// Sort results
function sortResults() {
    const sortOption = document.getElementById('sortDropdown').value;
    
    switch (sortOption) {
        case 'date-desc':
            filteredResults.sort((a, b) => new Date(b.date) - new Date(a.date));
            break;
        case 'date-asc':
            filteredResults.sort((a, b) => new Date(a.date) - new Date(b.date));
            break;
        case 'score-desc':
            filteredResults.sort((a, b) => b.percentage - a.percentage);
            break;
        case 'score-asc':
            filteredResults.sort((a, b) => a.percentage - b.percentage);
            break;
    }
    
    // Update table
    updateResultsTable();
}

// Update results table
function updateResultsTable() {
    const resultsTableBody = document.getElementById('resultsTableBody');
    resultsTableBody.innerHTML = '';
    
    if (filteredResults.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = `<td colspan="6" style="text-align: center;">No test results found</td>`;
        resultsTableBody.appendChild(row);
        
        // Clear pagination
        document.getElementById('resultsPagination').innerHTML = '';
        return;
    }
    
    // Paginate results
    const startIndex = (currentPage - 1) * resultsPerPage;
    const endIndex = Math.min(startIndex + resultsPerPage, filteredResults.length);
    const paginatedResults = filteredResults.slice(startIndex, endIndex);
    
    // Create rows
    paginatedResults.forEach(result => {
        const date = new Date(result.date);
        const formattedDate = `${date.toLocaleDateString()} ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
        
        const subject = getSubjectFromTestId(result.testId).toLowerCase().replace(' ', '-');
        const subjectName = getSubjectFromTestId(result.testId);
        
        // Format time taken
        const minutes = Math.floor(result.timeTaken / 60);
        const seconds = result.timeTaken % 60;
        const formattedTime = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${result.testTitle}</td>
            <td><span class="badge badge-${subject}">${subjectName}</span></td>
            <td>${result.score}/${result.totalQuestions} (${result.percentage}%)</td>
            <td>${formattedTime}</td>
            <td>${formattedDate}</td>
            <td>
                <button class="btn btn-outline" onclick="viewResultDetail('${result.id}')">Details</button>
            </td>
        `;
        resultsTableBody.appendChild(row);
    });
    
    // Update pagination
    updatePagination();
}

// Update pagination controls
function updatePagination() {
    const totalPages = Math.ceil(filteredResults.length / resultsPerPage);
    const paginationElement = document.getElementById('resultsPagination');
    paginationElement.innerHTML = '';
    
    if (totalPages <= 1) return;
    
    // Previous button
    const prevButton = document.createElement('button');
    prevButton.className = `page-btn ${currentPage === 1 ? 'disabled' : ''}`;
    prevButton.textContent = '←';
    prevButton.disabled = currentPage === 1;
    prevButton.addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            updateResultsTable();
        }
    });
    paginationElement.appendChild(prevButton);
    
    // Page buttons
    const maxVisiblePages = 5;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
    let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
    
    if (endPage - startPage + 1 < maxVisiblePages) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
    }
    
    for (let i = startPage; i <= endPage; i++) {
        const pageButton = document.createElement('button');
        pageButton.className = `page-btn ${i === currentPage ? 'active' : ''}`;
        pageButton.textContent = i;
        pageButton.addEventListener('click', () => {
            currentPage = i;
            updateResultsTable();
        });
        paginationElement.appendChild(pageButton);
    }
    
    // Next button
    const nextButton = document.createElement('button');
    nextButton.className = `page-btn ${currentPage === totalPages ? 'disabled' : ''}`;
    nextButton.textContent = '→';
    nextButton.disabled = currentPage === totalPages;
    nextButton.addEventListener('click', () => {
        if (currentPage < totalPages) {
            currentPage++;
            updateResultsTable();
        }
    });
    paginationElement.appendChild(nextButton);
}

// View detailed test result
function viewResultDetail(resultId) {
    const result = testResults.find(r => r.id === resultId);
    if (!result) return;
    
    const modalContent = document.getElementById('resultDetailContent');
    
    // Format time taken
    const minutes = Math.floor(result.timeTaken / 60);
    const seconds = result.timeTaken % 60;
    const formattedTime = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    // Set title
    document.getElementById('detailTestTitle').textContent = result.testTitle;
    
    // Create content
    let content = `
        <div class="user-stats">
            <div class="stat-box">
                <h4>Score</h4>
                <p>${result.score}/${result.totalQuestions}</p>
            </div>
            <div class="stat-box">
                <h4>Percentage</h4>
                <p>${result.percentage}%</p>
            </div>
            <div class="stat-box">
                <h4>Time Taken</h4>
                <p>${formattedTime}</p>
            </div>
            <div class="stat-box">
                <h4>Date</h4>
                <p>${new Date(result.date).toLocaleDateString()}</p>
            </div>
        </div>
        <h3>Question Breakdown</h3>
    `;
    
    // Add questions and answers
    result.details.forEach((detail, index) => {
        // Get question and options from the test data
        const question = sampleQuestions.find(q => q.question === detail.question);
        const options = question ? question.options : [];
        
        content += `
            <div class="question-result ${detail.isCorrect ? 'correct' : 'incorrect'}">
                <h4>Question ${index + 1}: ${detail.question}</h4>
                <p><strong>Your answer:</strong> ${detail.userAnswer >= 0 && options.length > 0 ? options[detail.userAnswer] : 'Not answered'}</p>
                <p><strong>Correct answer:</strong> ${detail.correctAnswer >= 0 && options.length > 0 ? options[detail.correctAnswer] : 'Unknown'}</p>
                <p><strong>Status:</strong> ${detail.isCorrect ? '✓ Correct' : '✗ Incorrect'}</p>
                ${detail.explanation ? `<p><strong>Explanation:</strong> ${detail.explanation}</p>` : ''}
            </div>
        `;
    });
    
    modalContent.innerHTML = content;
    openModal('resultDetailModal');
}
        // Sample data
        const testData = {
            biology: [
                { id: 'bio1', title: 'Cell Biology Basics', questions: 20, time: 30 },
                { id: 'bio2', title: 'Genetics and Heredity', questions: 25, time: 40 },
                { id: 'bio3', title: 'Ecology and Ecosystems', questions: 15, time: 25 }
            ],
            chemistry: [
                { id: 'chem1', title: 'Atomic Structure', questions: 20, time: 30 },
                { id: 'chem2', title: 'Chemical Bonding', questions: 25, time: 35 },
                { id: 'chem3', title: 'Acids and Bases', questions: 15, time: 20 }
            ],
            physics: [
                { id: 'phys1', title: 'Mechanics', questions: 20, time: 40 },
                { id: 'phys2', title: 'Electricity and Magnetism', questions: 25, time: 45 },
                { id: 'phys3', title: 'Thermodynamics', questions: 15, time: 30 }
            ],
            'earth-science': [
                { id: 'earth1', title: 'Geology Fundamentals', questions: 20, time: 30 },
                { id: 'earth2', title: 'Meteorology', questions: 25, time: 35 },
                { id: 'earth3', title: 'Astronomy', questions: 15, time: 25 }
            ]
        };

        // Sample questions (just for demo)
        const sampleQuestions = [
            {
                id: 1,
                question: "Which organelle is known as the 'powerhouse of the cell'?",
                options: ["Nucleus", "Mitochondria", "Golgi apparatus", "Endoplasmic reticulum"],
                answer: 1
            },
            {
                id: 2,
                question: "What is the primary function of chloroplasts in plant cells?",
                options: ["Cell division", "Protein synthesis", "Photosynthesis", "Energy storage"],
                answer: 2
            },
            {
                id: 3,
                question: "Which of the following is NOT a component of the cell membrane?",
                options: ["Phospholipids", "Proteins", "Carbohydrates", "DNA"],
                answer: 3
            },
            {
                id: 4,
                question: "What process is responsible for the movement of substances from an area of high concentration to an area of low concentration?",
                options: ["Active transport", "Facilitated diffusion", "Osmosis", "Diffusion"],
                answer: 3
            },
            {
                id: 5,
                question: "Which of the following cell types does NOT contain a nucleus?",
                options: ["Mature red blood cells", "Nerve cells", "Muscle cells", "Skin cells"],
                answer: 0
            }
        ];

        // User data storage (would be handled by a database in a real app)
        let currentUser = null;
        let users = [];
        let testResults = [];
        let currentTest = null;
        let timer = null;
        let seconds = 0;

        // DOM elements
        const homeSection = document.querySelector('.home-section');
        const testsSection = document.querySelector('.tests-section');
        const testTakingSection = document.querySelector('.test-taking-section');
        const resultsSection = document.querySelector('.test-results-section');
        const dashboardSection = document.getElementById('dashboardSection');
        const authButtons = document.getElementById('authButtons');
        const userArea = document.getElementById('userArea');
        const welcomeUser = document.getElementById('welcomeUser');

        // Check for local storage data
        function loadStoredData() {
            const storedUsers = localStorage.getItem('sciOlyUsers');
            const storedResults = localStorage.getItem('sciOlyResults');
            const storedCurrentUser = localStorage.getItem('sciOlyCurrentUser');
            
            if (storedUsers) users = JSON.parse(storedUsers);
            if (storedResults) testResults = JSON.parse(storedResults);
            if (storedCurrentUser) {
                currentUser = JSON.parse(storedCurrentUser);
                updateAuthUI();
                updateDashboard();
            }
        }

        // Save data to local storage
        function saveData() {
            localStorage.setItem('sciOlyUsers', JSON.stringify(users));
            localStorage.setItem('sciOlyResults', JSON.stringify(testResults));
            if (currentUser) {
                localStorage.setItem('sciOlyCurrentUser', JSON.stringify(currentUser));
            } else {
                localStorage.removeItem('sciOlyCurrentUser');
            }
        }

        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function switchModal(closeId, openId) {
            closeModal(closeId);
            openModal(openId);
        }

        // Section visibility functions
        function showSection(section) {
            homeSection.style.display = 'none';
            testsSection.style.display = 'none';
            testTakingSection.style.display = 'none';
            resultsSection.style.display = 'none';
            dashboardSection.style.display = 'none';
            
            if (section === 'home') homeSection.style.display = 'block';
            else if (section === 'tests') testsSection.style.display = 'block';
            else if (section === 'taking') testTakingSection.style.display = 'block';
            else if (section === 'results') resultsSection.style.display = 'block';
            else if (section === 'dashboard') dashboardSection.style.display = 'block';
        }

        function showTestsSection() {
            showSection('tests');
        }

        function goBack() {
            showSection('home');
        }

        // Test list functions
        function showTestList(subject) {
            const testsList = document.getElementById('testsList');
            testsList.innerHTML = '';
            
            const subjectTests = testData[subject] || [];
            
            if (subjectTests.length === 0) {
                testsList.innerHTML = '<p>No tests available for this subject yet.</p>';
                return;
            }
            
            subjectTests.forEach(test => {
                const testCard = document.createElement('div');
                testCard.className = 'card';
                testCard.innerHTML = `
                    <h3>${test.title}</h3>
                    <p>${test.questions} questions | ${test.time} minutes</p>
                    <button class="btn btn-outline" onclick="startTest('${test.id}', '${test.title}')">Start Test</button>
                `;
                testsList.appendChild(testCard);
            });
            
            showSection('tests');
        }

        // Test taking functions
        function startTest(testId, testTitle) {
            // Check if user is logged in
            if (!currentUser && testId !== 'demo') {
                alert("Please log in to take this test and save your results.");
                openModal('loginModal');
                return;
            }
            
            document.getElementById('testTitle').textContent = testTitle;
            
            const testContainer = document.getElementById('testContainer');
            testContainer.innerHTML = '';
            
            // Load questions (in a real app, these would come from a server)
            currentTest = {
                id: testId,
                title: testTitle,
                questions: sampleQuestions,
                startTime: new Date()
            };
            
            sampleQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.innerHTML = `
                    <h3>Question ${index + 1}: ${q.question}</h3>
                    <div class="options">
                        ${q.options.map((option, i) => `
                            <div class="option" data-question="${q.id}" data-option="${i}" onclick="selectOption(this)">
                                <input type="radio" id="q${q.id}o${i}" name="q${q.id}">
                                <label for="q${q.id}o${i}">${option}</label>
                            </div>
                        `).join('')}
                    </div>
                `;
                testContainer.appendChild(questionDiv);
            });
            
            // Start timer
            startTimer();
            
            showSection('taking');
        }

        function selectOption(optionElement) {
            // Clear other selections for this question
            const questionId = optionElement.dataset.question;
            const options = document.querySelectorAll(`.option[data-question="${questionId}"]`);
            options.forEach(opt => {
                opt.classList.remove('selected');
                opt.querySelector('input').checked = false;
            });
            
            // Select this option
            optionElement.classList.add('selected');
            optionElement.querySelector('input').checked = true;
        }

        function startTimer() {
            seconds = 0;
            clearInterval(timer);
            timer = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            seconds++;
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            document.getElementById('timer').textContent = `Time: ${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function stopTimer() {
            clearInterval(timer);
        }

        function submitTest() {
            stopTimer();
            
            // Calculate score
            let score = 0;
            const results = [];
            
            currentTest.questions.forEach(question => {
                const selectedOption = document.querySelector(`.option.selected[data-question="${question.id}"]`);
                const userAnswer = selectedOption ? parseInt(selectedOption.dataset.option) : -1;
                
                const isCorrect = (userAnswer === question.answer);
                if (isCorrect) score++;
                
                results.push({
                    question: question.question,
                    userAnswer: userAnswer,
                    correctAnswer: question.answer,
                    isCorrect: isCorrect,
                    explanation: "Explanation would go here in a real app."
                });
            });
            
            // Calculate time taken
            const endTime = new Date();
            const timeTaken = Math.floor((endTime - currentTest.startTime) / 1000);
            
            // Save result if logged in
            if (currentUser) {
                const result = {
                    id: Date.now().toString(),
                    userId: currentUser.id,
                    testId: currentTest.id,
                    testTitle: currentTest.title,
                    score: score,
                    totalQuestions: currentTest.questions.length,
                    percentage: Math.round((score / currentTest.questions.length) * 100),
                    timeTaken: timeTaken,
                    date: new Date().toISOString(),
                    details: results
                };
                
                testResults.push(result);
                saveData();
                updateDashboard();
            }
            
            // Show results
            showResults(score, currentTest.questions.length, timeTaken, results);
        }

        function showResults(score, total, timeTaken, details) {
            document.getElementById('resultTitle').textContent = currentTest.title;
            document.getElementById('scoreValue').textContent = `${score}/${total}`;
            document.getElementById('percentageValue').textContent = `${Math.round((score / total) * 100)}%`;
            
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;
            document.getElementById('timeTaken').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const resultDetails = document.getElementById('resultDetails');
            resultDetails.innerHTML = '<h3>Question Details</h3>';
            
            details.forEach((detail, index) => {
                const detailDiv = document.createElement('div');
                detailDiv.className = `question ${detail.isCorrect ? 'correct' : 'incorrect'}`;
                detailDiv.innerHTML = `
                    <h4>Question ${index + 1}: ${detail.question}</h4>
                    <p>Your answer: ${detail.userAnswer >= 0 ? currentTest.questions[index].options[detail.userAnswer] : 'Not answered'}</p>
                    <p>Correct answer: ${currentTest.questions[index].options[detail.correctAnswer]}</p>
                    <p style="color: ${detail.isCorrect ? 'green' : 'red'}">
                        ${detail.isCorrect ? '✓ Correct' : '✗ Incorrect'}
                    </p>
                `;
                resultDetails.appendChild(detailDiv);
            });
            
            showSection('results');
        }

        // Authentication functions
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                updateAuthUI();
                saveData();
                closeModal('loginModal');
                updateDashboard();
                alert("Login successful!");
            } else {
                alert("Invalid email or password.");
            }
        });

        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                alert("Passwords don't match!");
                return;
            }
            
            if (users.some(u => u.email === email)) {
                alert("Email already in use!");
                return;
            }
            
            const newUser = {
                id: Date.now().toString(),
                name,
                email,
                password // In a real app, this would be hashed
            };
            
            users.push(newUser);
            currentUser = newUser;
            updateAuthUI();
            saveData();
            closeModal('registerModal');
            alert("Registration successful!");
        });

        // Continuing the JavaScript code from before:

function updateAuthUI() {
    if (currentUser) {
        authButtons.style.display = 'none';
        userArea.style.display = 'flex';
        welcomeUser.textContent = `Welcome, ${currentUser.name}!`;
        
        // Show dashboard button in navbar if not already there
        const navLinks = document.querySelector('.nav-links');
        if (!document.getElementById('dashboardLink')) {
            const dashLink = document.createElement('a');
            dashLink.id = 'dashboardLink';
            dashLink.href = '#';
            dashLink.textContent = 'Dashboard';
            dashLink.addEventListener('click', function() {
                showSection('dashboard');
            });
            navLinks.appendChild(dashLink);
        }
    } else {
        authButtons.style.display = 'flex';
        userArea.style.display = 'none';
        
        // Remove dashboard link if it exists
        const dashLink = document.getElementById('dashboardLink');
        if (dashLink) dashLink.remove();
    }
}

function logout() {
    currentUser = null;
    updateAuthUI();
    localStorage.removeItem('sciOlyCurrentUser');
    showSection('home');
}

// Dashboard functions
function updateDashboard() {
    if (!currentUser) return;
    
    const userResults = testResults.filter(r => r.userId === currentUser.id);
    document.getElementById('testsCompleted').textContent = userResults.length;
    
    // Calculate average score
    if (userResults.length > 0) {
        const totalPercentage = userResults.reduce((sum, result) => sum + result.percentage, 0);
        const averagePercentage = Math.round(totalPercentage / userResults.length);
        document.getElementById('averageScore').textContent = `${averagePercentage}%`;
    } else {
        document.getElementById('averageScore').textContent = 'N/A';
    }
    
    // Populate results table
    const resultsTableBody = document.getElementById('resultsTableBody');
    resultsTableBody.innerHTML = '';
    
    // Sort by date (newest first)
    userResults.sort((a, b) => new Date(b.date) - new Date(a.date));
    
    // Show only the 5 most recent results
    const recentResults = userResults.slice(0, 5);
    
    if (recentResults.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = '<td colspan="5">No test results yet. Take a test to see your results here.</td>';
        resultsTableBody.appendChild(row);
    } else {
        recentResults.forEach(result => {
            const date = new Date(result.date);
            const formattedDate = `${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${result.testTitle}</td>
                <td>${getSubjectFromTestId(result.testId)}</td>
                <td>${result.score}/${result.totalQuestions} (${result.percentage}%)</td>
                <td>${formattedDate}</td>
                <td>
                    <button class="btn btn-outline" onclick="viewResult('${result.id}')">View</button>
                </td>
            `;
            resultsTableBody.appendChild(row);
        });
    }
}

function getSubjectFromTestId(testId) {
    // Extract subject from test ID (in a real app, this would be more robust)
    if (testId.startsWith('bio')) return 'Biology';
    if (testId.startsWith('chem')) return 'Chemistry';
    if (testId.startsWith('phys')) return 'Physics';
    if (testId.startsWith('earth')) return 'Earth Science';
    return 'General';
}

function viewResult(resultId) {
    const result = testResults.find(r => r.id === resultId);
    if (!result) return;
    
    // Set up the results display similar to submitTest()
    currentTest = {
        id: result.testId,
        title: result.testTitle,
        questions: sampleQuestions // In a real app, these would be stored with the result
    };
    
    showResults(result.score, result.totalQuestions, result.timeTaken, result.details);
}

// Helper function for demo
function startDemoTest() {
    startTest('demo', 'Demo Test: Cell Biology');
}

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
    loadStoredData();
    updateAuthUI();
});
</script>
</body>